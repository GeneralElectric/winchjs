angular.module("winch",[]),angular.module("winch").service("Throttle",["$q","$timeout",function(a,b){function c(a){return g.hasOwnProperty(a)}function d(a){delete g[a]}function e(a){return g[a]}function f(a,b){g[a]=b}var g={};return{throttle:function(g,h){var i=a.defer();return h=parseInt(h,10),0>=h&&(h=100),"function"==typeof g?c(g)?e(g).promise:(b(function(){g(),i.resolve(),d(g)},h),f(g,i),i.promise):(i.reject("Not a Function"),i.promise)}}}]),angular.module("winch").factory("winchFactory",[function(){var a={_img:{}};return a.registerImg=function(b,c,d){return"function"!=typeof c?!1:"function"!=typeof d?!1:"string"!=typeof b||b.length<1?!1:(a._img.hasOwnProperty(b)?a._img[b].loaded?c():(a._img[b].fnLoad.push(c),a._img[b].fnValidate.push(d)):a._img[b]={fnLoad:[c],fnValidate:[d],loaded:!1},!0)},a.loadImage=function(b){var c,d=0;if(a._img.hasOwnProperty(b)){for(c=a._img[b].fnLoad.length,d=0;c>d;d+=1)a._img[b].fnLoad[d]();a._img[b]={loaded:!0,fnValidate:[],fnLoad:[]}}},a.triggerValidation=function(b){var c,d,e,f;if(b&&a._img[b])for(e=0;e<a._img[b].fnValidate.length;e+=1)a._img[b].fnValidate[e]()&&a.loadImage(b);else if(!b)for(d=Object.keys(a._img),c=0;c<d.length;c+=1)for(f=a._img[d[c]].fnValidate.length,e=0;f>e;e+=1)a._img[d[c]].fnValidate[e]&&a._img[d[c]].fnValidate[e]()&&a.loadImage(d[c])},a.setWindowView=function(b,c){a.windowWidth=c,a.windowHeight=b},a.getWindowWidth=function(){return a.windowWidth},a.getWindowHeight=function(){return a.windowHeight},a.getMasterBox=function(){return{top:0,bottom:a.windowHeight,left:0,right:a.windowWidth,vOffset:100,hOffset:100}},a}]),angular.module("winch").filter("winchify",function(){return function(a){function b(a){if(a.search(c)>-1){var d=a.indexOf(">",a.search(c)+f.length);return a.substr(0,d+1)+"</img>"+b(a.substr(d+1))}return a}var c,d,e,f="<img",g="</img>",h="ng-src";return c=new RegExp(f,"gi"),d=new RegExp(g,"gi"),e=new RegExp(h,"gi"),a.search(c)>-1?a=b(a).replace(c,"<winch-img").replace(e,"img-src").replace(d,"</winch-img>"):a}}),angular.module("winch").directive("winchMaster",["$window","$timeout","winchFactory","Throttle",function(a,b,c,d){return{restrict:"AE",link:function(e,f,g){function h(){c.setWindowView(a.innerHeight,a.innerWidth)}var i,j,k=angular.element(a);e._scrollObjects=[k],g.winchMaster&&g.winchMaster.split(",").forEach(function(b){for(i=a.document.querySelectorAll(b),j=0;j<i.length;j+=1)e._scrollObjects.push(angular.element(i[j]))}),e.setupScrollers=function(){e._scrollObjects.forEach(function(a){a.on("scroll",function(){e.triggerValidation()})})},e.setupScrollers(),k.on("resize",function(){h(),e.triggerValidation()}),e.$on("$destroy",function(){e._scrollObjects.forEach(function(a){a.off("scroll")})}),e.triggerValidation=function(){d.throttle(c.triggerValidation,100)},h(),b(function(){e.triggerValidation()},100)}}}]),angular.module("winch").directive("winchScrollTrigger",["winchFactory","Throttle","$timeout",function(a,b,c){return{restrict:"A",scope:{winchScrollTrigger:"@"},link:function(d,e){function f(a){a.on("scroll",function(){d.triggerValidation()}),a.on("transitionend webkitTransitionEnd oTransitionEnd",function(){d.triggerValidation()}),a.on("transitionstart webkitTransitionStart oTransitionStart",function(){d.triggerValidation()})}function g(a){a.off("scroll"),a.off("transionend webkitTransitionEnd oTransitionEnd"),a.off("transitionstart webkitTransitionStart oTransitionStart")}var h,i,j,k;d._scrollObjects=[e],d.winchScrollTrigger&&(i=d.winchScrollTrigger.split(","),k=c(function(){try{i.forEach(function(a){for(h=e[0].querySelectorAll(a),j=0;j<h.length;j+=1)d._scrollObjects.push(angular.element(h[j]))})}catch(a){throw new Error("Error during scroller selection, most likely a bad selector:",d.winchScrollTrigger)}for(j=1;j<d._scrollObjects.length;j+=1)f(d._scrollObjects[j])},300)),f(d._scrollObjects[0]),d.triggerValidation=function(){b.throttle(a.triggerValidation,100)},d.$on("$destroy",function(){for(c.cancel(k),j=0;j<d._scrollObjects.length;j+=1)g(d._scrollObjects[j])})}}}]),angular.module("winch").directive("winchImg",["$compile","$timeout","winchFactory",function(a,b,c){return{priority:0,restrict:"AE",scope:{imgUrl:"&",imgLoaded:"&"},link:function(d,e,f){function g(a,b){return a.bottom+b.vOffset>=b.top}function h(a,b){return a.top-b.vOffset<=b.bottom}function i(a,b){return a.right+b.hOffset>=b.left}function j(a,b){return a.right-b.hOffset<=b.right}function k(a,b){return a.left<=b.left-b.hOffset&&a.right>=b.right+b.hOffset||a.bottom>=b.bottom+b.vOffset&&a.top<=b.top-b.vOffset}var l;d._isLoaded=!1,e.addClass("winch-img-not-loaded"),d.registerImg=function(a){c.registerImg(d.getImgURL(),d.loadSelf,d.isVisible)||(5>a?b(function(){d.registerImg(a+1)},1e3):d.loadSelf())},d.isVisible=function(){var a=d.boundingBox(),b=c.getMasterBox();return k(a,b)||g(a,b)&&h(a,b)&&i(a,b)&&j(a,b)},d.loadSelf=function(){if(!d._isLoaded){e.addClass("winch-img-loaded").removeClass("winch-img-not-loaded"),l=a('<img class="winch-img" data-ng-src="{{getImgURL()}}">')(d),f.winchImgClass&&angular.element(l).addClass(f.winchImgClass),e.empty().append(l),d._isLoaded=!0;try{d.imgLoaded()}catch(c){}b(function(){d.$destroy()},100)}},d.boundingBox=function(){return e[0].getBoundingClientRect()},d.getImgURL=function(){return d.imgUrl&&"undefined"!=typeof d.imgUrl()?d.imgUrl():f.src||f.imgSrc},d.$on("winch:validate",function(){d.isVisible()&&(d.loadSelf(),c.loadImage(d.getImgURL()))}),d.registerImg(1)}}}]);
//# sourceMappingURL=winch.map